<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SBC Interface Introduction • SBC</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="SBC Interface Introduction">
<meta property="og:description" content="SBC">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SBC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://mc-stan.org/rstan">rstan</a>
    </li>
    <li>
      <a href="https://mc-stan.org/cmdstanr">cmdstanr</a>
    </li>
    <li>
      <a href="http://paul-buerkner.github.io/brms/">brms</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstanarm">rstanarm</a>
    </li>
    <li>
      <a href="http://mc-stan.org/bayesplot">bayesplot</a>
    </li>
    <li>
      <a href="http://mc-stan.org/shinystan">shinystan</a>
    </li>
    <li>
      <a href="http://mc-stan.org/loo">loo</a>
    </li>
    <li>
      <a href="http://mc-stan.org/projpred">projpred</a>
    </li>
    <li>
      <a href="http://mc-stan.org/rstantools">rstantools</a>
    </li>
    <li>
      <a href="https://mc-stan.org/posterior">posterior</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://mc-stan.org">Stan</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://twitter.com/mcmc_stan">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/hyunjimoon/SBC">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://discourse.mc-stan.org/">
    <span class="fa fa-users"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="basic_usage_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>SBC Interface Introduction</h1>
                        <h4 class="author">Hyunji Moon, Martin Modrák, Shinyoung Kim</h4>
            
            <h4 class="date">2021-09-18</h4>
      
      
      <div class="hidden name"><code>basic_usage.Rmd</code></div>

    </div>

    
    
<div id="what-is-sbc" class="section level2">
<h2 class="hasAnchor">
<a href="#what-is-sbc" class="anchor"></a>What is SBC?</h2>
<p>SBC stands for “simulation-based calibration” and it is a tool to validate statistical models and/or algorithms fitting those models. In SBC we are given a statistical model, a method to generate samples from the prior predictive distribution (i.e. generate simulated datasets that match the model’s priors + likelihood) and an algorithm that fits the model to data.</p>
<p>The rough sketch of SBC is that we simulate some datasets and then for each dataset:</p>
<ol style="list-style-type: decimal">
<li>Fit the model and obtain <span class="math inline">\(S\)</span> independent samples from the posterior.</li>
<li>For each parameter, take the rank of the simulated parameter value within the posterior samples
<ul>
<li>Where rank is defined as the number of samples &lt; simulated value</li>
</ul>
</li>
</ol>
<p>It can be shown that if model matched the generator and algorithm works correctly, then for each parameter, the ranks obtained in SBC should be uniformly distributed between <span class="math inline">\(0\)</span> and <span class="math inline">\(S\)</span>. This corresponds quite directly to claims like “the posterior 84% credible interval should contain the simulated value in 84% of simulations”, the rank uniformity represents this claim for all interval widths at once. The theory of SBC is fully described in <a href="https://arxiv.org/abs/1804.06788">Talts et al.</a></p>
<p>This opens two principal use-cases of SBC:</p>
<ol style="list-style-type: lower-alpha">
<li>We have an algorithm that we trust is correct and a generator and and we want to check that we correctly implemented our Bayesian model</li>
<li>We have a generator and a model we trust and we want to check whether a given algorithm correctly computes the posterior.</li>
</ol>
<p>In any case, a failure of SBC only tells us that at least one of the three pillars of our inference (generator/model/algorithm) is mismatched to others.</p>
<p>In the context of larger Bayesian workflow (as discussed e.g. in <a href="https://arxiv.org/abs/2011.01808">Bayesian Workflow</a> by Gelman et al.  or <a href="https://betanalpha.github.io/assets/case_studies/principled_bayesian_workflow.html">Towards A Principled Bayesian Workflow</a> by Betancourt), SBC can be used to validate the implementation of a model/algorithm, which is just one of many things to check if one needs a robust analysis. In particular, SBC does not use any real data and thus cannot tell you anything about potential mismatch between your model and the actual data you plan to analyze.</p>
<p>This vignette will demonstrate how the basic package interface can be used to run simulations, calculate ranks and investigate calibration.</p>
</div>
<div id="aims-of-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#aims-of-the-package" class="anchor"></a>Aims of the package</h2>
<p>The SBC package aims to provide a richer and more usable alternative to <code><a href="https://mc-stan.org/rstan/reference/sbc.html">rstan::sbc()</a></code>. The main design goals is to make it easy to incorporate SBC in your everyday modelling workflow. To this end:</p>
<ul>
<li>No changes to your model are needed to test it with SBC.</li>
<li>Once you have your model and code to simulate data ready, it is easy to gradually move from 1 simulation to check your model does not crash to 1000 simulations that can resolve even small inaccuracies.</li>
</ul>
<p>We intentionally do not focus on mechanisms that would let you automatically construct a simulator just from your model: if we did that, any bugs in your model would automatically carry over to the simulator and the SBC would only check that the algorithm works. Instead we believe it is good practice to implement the simulator in the most easy way possible while altering aspects of the implementation that should not matter (e.g. for loops vs. matrix multiplication). The best solution would be to have one person write the simulator and a different person the model (though that would often be impractical). This way you get two independent pieces of code that should correspond to the same data generating process and it becomes less likely that there is the same mistake in both versions. A mistake that is in just one version can then be (at least in principle) caught by SBC.</p>
<p>This is actually a well known pattern in software safety: critical components in airplanes are required to have two completely independent implementations of the same software (or even hardware) and the system checks that both produce the same output for the same input. Similarly, pharmaceutical companies analyzing drug trials are required to have the data analysis pipeline written by two separate teams and the results of both must match (this is not required for academic trials - who would need safety there, right?). The main reason this method is used relatively rarely is that implementing the same thing twice is costly. But statistical models are usually relatively small pieces of code and the added cost of the second implementation (the generator) thus tends to very small.</p>
</div>
<div id="overview-of-the-architecture" class="section level2">
<h2 class="hasAnchor">
<a href="#overview-of-the-architecture" class="anchor"></a>Overview of the Architecture</h2>
<div class="figure">
<img src="overview_wide.png" alt=""><p class="caption">Overview of the package structure</p>
</div>
<p>To perform SBC, one needs to first generate simulated datasets and then fit the model to those datasets. The <code>SBC_datasets</code> object holds the simulated prior and data samples. <code>SBC_datasets</code> objects can be created directly by the user, but it is often easier to use one of provided <em>Generator</em> implementations that let you e.g. wrap a function that returns the parameters and simulated data for a single dataset or use a <code>brms</code> specification to generate samples corresponding to a given <code>brms</code> model.</p>
<p>The other big part of the process is a <em>backend</em>. The SBC package uses a backend object to actually fit the model to the simulated data and generate posterior samples. In short, backend bunches together the algorithm in which inference is ran (<code>cmdstanr</code>, <code>rstan</code>, <code>brms</code>, <code>jags</code>, etc.), the model, and additional platform-specific inference parameters which are necessary to run inference for the model-platform combination (e.g. number of iterations, initial values, …). In other words backend is a function that takes data as its only input and provides posterior samples.</p>
<p>Once we have a backend and an <code>SBC_datasets</code> instance, we can call <code>compute_results</code> to actually perform the SBC. The resulting object can then be passed to various plotting and summarising functions to let us easily learn if our model works as expected.</p>
</div>
<div id="simple-poisson-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#simple-poisson-regression" class="anchor"></a>Simple Poisson Regression</h2>
<p>In this vignette we will demonstrate how the interface is used with a simple poisson model. First we’ll setup and configure our environment.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SBC</span><span class="op">)</span>;

<span class="va">use_cmdstanr</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span> <span class="co"># Set to false to use rstan instead</span>

<span class="kw">if</span><span class="op">(</span><span class="va">use_cmdstanr</span><span class="op">)</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/cmdstanr">cmdstanr</a></span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/">rstan</a></span><span class="op">)</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>mc.cores <span class="op">=</span> <span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Enabling parallel processing via future</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/future">future</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span>

<span class="co"># The fits are very fast,</span>
<span class="co"># so we force a minimum chunk size to reduce overhead of</span>
<span class="co"># paralellization and decrease computation time.</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>SBC.min_chunk_size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="co"># Setup caching of results</span>
<span class="va">cache_dir</span> <span class="op">&lt;-</span> <span class="st">"./basic_usage_SBC_cache"</span>
<span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="va">cache_dir</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="va">cache_dir</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<div id="model-setup" class="section level3">
<h3 class="hasAnchor">
<a href="#model-setup" class="anchor"></a>Model Setup</h3>
<p>We will be running SBC against a model that defines <code>y ~ Poisson(lambda)</code>, where <code>lambda ~ Gamma(15, 5)</code>. We will use the following Stan model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="st">"stan/poisson.stan"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span></code></pre></div>
<pre><code>data{
  int N;
  int y[N];
}
parameters{
  real&lt;lower = 0&gt; lambda;
}
model{
  lambda ~ gamma(15, 5);
  y ~ poisson(lambda);
}</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="va">use_cmdstanr</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">cmdstan_model</span> <span class="op">&lt;-</span> <span class="fu">cmdstanr</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/cmdstanr/reference/cmdstan_model.html">cmdstan_model</a></span><span class="op">(</span><span class="st">"stan/poisson.stan"</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="va">rstan_model</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stan_model.html">stan_model</a></span><span class="op">(</span><span class="st">"stan/poisson.stan"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="generator" class="section level3">
<h3 class="hasAnchor">
<a href="#generator" class="anchor"></a>Generator</h3>
<p>Once we have defined the model, we can create a generator function which will generate prior and data samples:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># A generator function should return a named list containing elements "parameters" and "generated"</span>

<span class="va">poisson_generator_single</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">{</span>  <span class="co"># N is the number of data points we are generating</span>
  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html">rgamma</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="fl">15</span>, rate <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, lambda <span class="op">=</span> <span class="va">lambda</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
    parameters <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      lambda <span class="op">=</span> <span class="va">lambda</span>
    <span class="op">)</span>,
    generated <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
      N <span class="op">=</span> <span class="va">N</span>,
      y <span class="op">=</span> <span class="va">y</span>
    <span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>As you can see, the generator returns a named list containing random samples from the prior and generated data realized from the prior samples - the data are already in the format expected by Stan.</p>
</div>
<div id="create-sbc_datasets-from-generator" class="section level3">
<h3 class="hasAnchor">
<a href="#create-sbc_datasets-from-generator" class="anchor"></a>Create <code>SBC_Datasets</code> from generator</h3>
<p><code>SBC</code> provides helper functions <code>SBC_generator_function</code> and <code>generate_datasets</code> which takes a generator function and calls it repeatedly to create a valid <code>SBC_datasets</code> object.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">54882235</span><span class="op">)</span>
<span class="va">n_datasets</span> <span class="op">&lt;-</span> <span class="fl">100</span>  <span class="co"># Number of SBC iterations to run</span>

<span class="va">poisson_generator</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SBC_generator_function.html">SBC_generator_function</a></span><span class="op">(</span><span class="va">poisson_generator_single</span>, N <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>
<span class="va">poisson_dataset</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/generate_datasets.html">generate_datasets</a></span><span class="op">(</span>
  <span class="va">poisson_generator</span>, 
  <span class="va">n_datasets</span><span class="op">)</span></code></pre></div>
</div>
<div id="defining-backend" class="section level3">
<h3 class="hasAnchor">
<a href="#defining-backend" class="anchor"></a>Defining backend</h3>
<p>Once we have the model compiled we’ll create a backend object from the model. <code>SBC</code> includes pre-defined backend objects for HMC sampling with <code>cmdstan</code> and <code>rstan</code>. In addition, it also provides generator function and backend for <code>brms</code> based models.</p>
<p>Note that you can create your own backend if you wish to use a different sampling/optimization platform, such as variational inference or JAGS.</p>
<p>Here we’ll just use the pre-defined cmdstan backend, in which we pass our compiled model and any additional arguments we would like to pass over to the sampling method:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span><span class="op">(</span><span class="va">use_cmdstanr</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">poisson_backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SBC_backend_cmdstan_sample.html">SBC_backend_cmdstan_sample</a></span><span class="op">(</span>
    <span class="va">cmdstan_model</span>, iter_warmup <span class="op">=</span> <span class="fl">1000</span>, iter_sampling <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="va">poisson_backend</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/SBC_backend_rstan_sample.html">SBC_backend_rstan_sample</a></span><span class="op">(</span>
    <span class="va">rstan_model</span>, iter <span class="op">=</span> <span class="fl">2000</span>, warmup <span class="op">=</span> <span class="fl">1000</span>, chains <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>  
<span class="op">}</span></code></pre></div>
</div>
<div id="computing-ranks" class="section level3">
<h3 class="hasAnchor">
<a href="#computing-ranks" class="anchor"></a>Computing Ranks</h3>
<p>we can then use <code>compute_results</code> to fit our datasets with the backend:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_results.html">compute_results</a></span><span class="op">(</span><span class="va">poisson_dataset</span>, <span class="va">poisson_backend</span>, 
                    cache_mode <span class="op">=</span> <span class="st">"results"</span>, 
                    cache_location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">cache_dir</span>, <span class="st">"results"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Results loaded from cache file 'results'</code></pre>
<p>Here we also use the caching feature to avoid recomputing the fits when recompiling this vignette. In practice, caching is not necessary but is often useful.</p>
</div>
<div id="viewing-results" class="section level3">
<h3 class="hasAnchor">
<a href="#viewing-results" class="anchor"></a>Viewing Results</h3>
<p>We can now inspect the results to see if there were any errors and check individual stats:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span><span class="op">$</span><span class="va">stats</span></code></pre></div>
<pre><code>## # A tibble: 100 x 15
##    dataset_id parameter simulated_value  rank z_score  mean median    sd   mad
##         &lt;int&gt; &lt;chr&gt;               &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1          1 lambda               1.44    14  -1.56   1.73   1.72 0.187 0.183
##  2          2 lambda               2.99    75  -0.226  3.05   3.04 0.265 0.262
##  3          3 lambda               2.51    44  -0.740  2.69   2.68 0.249 0.253
##  4          4 lambda               2.86    59  -0.666  3.04   3.03 0.265 0.256
##  5          5 lambda               2.97   182   1.28   2.66   2.66 0.244 0.244
##  6          6 lambda               2.54   150   0.776  2.36   2.36 0.236 0.240
##  7          7 lambda               2.65    17  -1.48   3.04   3.03 0.268 0.274
##  8          8 lambda               2.99   126   0.319  2.91   2.90 0.258 0.263
##  9          9 lambda               2.55    20  -1.22   2.87   2.86 0.255 0.250
## 10         10 lambda               1.73     8  -1.56   2.05   2.04 0.209 0.211
## # ... with 90 more rows, and 6 more variables: q5 &lt;dbl&gt;, q95 &lt;dbl&gt;, rhat &lt;dbl&gt;,
## #   ess_bulk &lt;dbl&gt;, ess_tail &lt;dbl&gt;, max_rank &lt;int&gt;</code></pre>
</div>
<div id="plots" class="section level3">
<h3 class="hasAnchor">
<a href="#plots" class="anchor"></a>Plots</h3>
<p>And finally, we can plot the rank distribution to check if the ranks are uniformly distributed. We can check the rank histogram and ECDF plots:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_rank_hist.html">plot_rank_hist</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></code></pre></div>
<p><img src="basic_usage_files/figure-html/rank_hist-1.png" width="700"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_ecdf.html">plot_ecdf</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></code></pre></div>
<p><img src="basic_usage_files/figure-html/ecdf-1.png" width="700"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plot_ecdf.html">plot_ecdf_diff</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></code></pre></div>
<p><img src="basic_usage_files/figure-html/ecdf_diff-1.png" width="700"></p>
<p>Since our simulator and model do match and Stan works well, we see that the plots don’t show any violation.</p>
</div>
</div>
<div id="is-sbc-frequentist" class="section level2">
<h2 class="hasAnchor">
<a href="#is-sbc-frequentist" class="anchor"></a>Is SBC frequentist?</h2>
<p>A bit of philosophy at the end - SBC is designed to test Bayesian models and/or algorithms, but it fits very well with standard frequentist ideas (and there is no shame about this). In fact, SBC can be understood as a very pure form of hypothesis testing as the “null hypothesis” that the ranks are uniformly distributed is completely well specified, can (beyond numerical error) actually hold exactly and we are conducting the test against a hypothesis of interest. SBC thus lets us follow a simple naive-Popperian way of thinking: we try hard to disprove a hypothesis (that our model + algorithm + generator is correct) and when we fail to disprove it, we can consider the hypothesis corroborated to the extent our test was severe. This is unlike many scientific applications of hypothesis testing where people use a rejection of the null hypothesis as evidence for alternative (which is usually not warranted).</p>
<p>We currently can’t provide a good theoretical understanding of the severity of a given SBC test, but obviously the more iterations and the narrower the confidence bands of the <code>ecdf</code> and <code>ecdf_diff</code> plots, the more severe the test. One can also use <code><a href="../reference/empirical_coverage.html">empirical_coverage()</a></code> and <code><a href="../reference/plot_coverage.html">plot_coverage()</a></code> functions to investigate the extent of miscalibration that we cannot rule out given our results so far.</p>
<p>Alternatively, one can somewhat sidestep the discussions about philosophy of statistics and understand SBC as a probabilistic unit test for your model. In this view, SBC tests a certain identity that we expect to hold if our system is implemented correctly, similarly how one could test an implementation of an arithmetical system by comparing the results of computing <span class="math inline">\((x + y)^2\)</span> and <span class="math inline">\(x^2 + 2xy + y^2\)</span> - any mismatch means the test failed.</p>
</div>
<div id="where-to-go-next" class="section level2">
<h2 class="hasAnchor">
<a href="#where-to-go-next" class="anchor"></a>Where to go next?</h2>
<p>You may want to explore short examples showing how SBC can be used to diagnose <a href="https://hyunjimoon.github.io/SBC/articles/bad_parametrization.html">bad parametrization</a> or <a href="https://hyunjimoon.github.io/SBC/articles/indexing.html">indexing bugs</a> or you may want to read through a longer example of what we consider best practice in <a href="https://hyunjimoon.github.io/SBC/articles/small_model_workflow.html">model-building workflow</a>.</p>
<p>Alternatively, you might be interested in the <a href="https://hyunjimoon.github.io/SBC/articles/limits_of_SBC.html">limits of SBC</a> — the types of problems that are hard / impossible to catch with SBC and what can we do to guard against those.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Shinyoung Kim, Hyunji Moon, Martin Modrák.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
